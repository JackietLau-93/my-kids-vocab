<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TinyVocab Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Varela+Round&display=swap" rel="stylesheet">
<style>
    :root {
        /* "Montessori" Palette */
        --c-animal: #8AC926; --c-food: #FFCA3A; --c-body: #1982C4; 
        --c-home: #FF595E; --c-act: #6A4C93;
        --bg: #F0F4F8; --text: #2D3436;
        --card-ratio: 0.71; /* ~2.5/3.5 standard poker ratio */
    }

    body { 
        font-family: 'Varela Round', sans-serif; 
        background: var(--bg); 
        margin: 0; 
        color: var(--text);
        -webkit-font-smoothing: antialiased;
    }

    /* --- HEADER --- */
    header { 
        background: white; padding: 15px 20px; 
        display: flex; justify-content: space-between; align-items: center; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.05); 
        position: sticky; top: 0; z-index: 100;
    }
    
    .btn { 
        padding: 10px 16px; border: none; border-radius: 12px; 
        cursor: pointer; font-family: 'Fredoka One'; font-size: 0.9rem;
        transition: transform 0.1s; background: #eee; color: #555;
    }
    .btn:active { transform: scale(0.95); }
    .btn-primary { background: #2D3436; color: white; box-shadow: 0 4px 0 #000; }
    .btn-primary:active { box-shadow: none; transform: translateY(4px); }

    /* --- GRID LAYOUT --- */
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
        gap: 20px; margin-top: 20px; 
    }
    
    /* --- CARD AESTHETICS --- */
    .vocab-card {
        aspect-ratio: 3/4; /* PORTRAIT LOCK */
        background: white; 
        border-radius: 20px; 
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.06); 
        transition: transform 0.2s;
        display: flex; flex-direction: column;
        border: 2px solid white;
        cursor: pointer;
    }
    .vocab-card:hover { transform: translateY(-5px) scale(1.02); }

    /* 75% Image Area */
    .card-img-frame {
        height: 75%;
        width: 100%;
        background: white;
        display: flex; align-items: center; justify-content: center;
        padding: 10px; box-sizing: border-box;
    }
    .vocab-card img { 
        max-width: 100%; max-height: 100%; 
        object-fit: contain; /* Ensures the whole dog/banana is seen */
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    /* 25% Text Area */
    .card-text-frame {
        height: 25%;
        display: flex; align-items: center; justify-content: center;
        background: #fdfdfd;
        border-top: 2px solid #f0f0f0;
        position: relative;
    }
    /* The Category Stripe */
    .cat-indicator {
        position: absolute; top: 0; left: 0; width: 100%; height: 6px;
    }
    .word { 
        font-family: 'Fredoka One'; 
        font-size: 1.6rem; 
        color: #444; 
        text-transform: lowercase; 
        letter-spacing: 0.5px;
    }

    /* --- CHILD MODE (The App) --- */
    #child-mode { 
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
        background: #fff; z-index: 200; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
    }
    
    /* The Big Focused Card */
    .focus-card {
        width: 85vw; max-width: 380px; aspect-ratio: 3/4;
        background: white; border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        border: 6px solid #333; /* Dynamic color */
        display: flex; flex-direction: column; overflow: hidden;
    }
    .focus-card img { flex: 1; width: 100%; height: 100%; object-fit: contain; padding: 30px; box-sizing: border-box; }
    .focus-card .word-box { 
        height: 25%; background: #fafafa; border-top: 2px solid #eee;
        display: flex; align-items: center; justify-content: center;
    }
    .focus-card h1 { font-family: 'Fredoka One'; font-size: 3rem; margin: 0; color: #333; }

    /* Controls */
    .controls { margin-top: 40px; display: flex; gap: 20px; align-items: center; }
    .nav-btn { 
        width: 70px; height: 70px; border-radius: 50%; border: none; 
        font-size: 2rem; background: #f0f0f0; cursor: pointer; color: #333;
        box-shadow: 0 6px 0 #ddd; transition: all 0.1s;
    }
    .nav-btn:active { transform: translateY(6px); box-shadow: none; }
    
    .play-btn { 
        width: 90px; height: 90px; font-size: 3rem; 
        background: #FFCA3A; box-shadow: 0 6px 0 #E0B130; color: white;
    }
    
    /* Loading Spinner */
    #loading { text-align: center; margin-top: 50px; color: #888; }

    /* --- PRINT STYLES --- */
    #print-area { display: none; }
    
    @media print {
        @page { margin: 0; }
        body { background: white; -webkit-print-color-adjust: exact; }
        header, .container, #child-mode { display: none !important; }
        #print-area { display: block !important; }
        
        /* COMMON PRINT RESET */
        .p-card { box-sizing: border-box; background: white; overflow: hidden; display: flex; flex-direction: column; }
        .p-img { display: flex; align-items: center; justify-content: center; }
        .p-img img { max-width: 90%; max-height: 90%; object-fit: contain; }
        .p-txt { display: flex; align-items: center; justify-content: center; font-family: 'Fredoka One'; text-transform: lowercase; }

        /* POKER LAYOUT (3x3 Grid) */
        .grid-poker { 
            display: grid; grid-template-columns: repeat(3, 63.5mm); grid-template-rows: repeat(3, 88.9mm); 
            padding: 10mm; gap: 0; 
        }
        .grid-poker .p-card { 
            width: 63.5mm; height: 88.9mm; border: 1px dashed #ddd; border-radius: 8px; position: relative;
        }
        .grid-poker .p-img { height: 75%; }
        .grid-poker .p-txt { height: 25%; font-size: 16pt; }
        .grid-poker .stripe { position: absolute; bottom: 25%; left: 0; width: 100%; height: 4px; }

        /* A4 LAYOUT (1 per page) */
        .layout-a4 .page { break-after: page; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .layout-a4 .p-card { 
            width: 260mm; height: 180mm; /* Landscape card */
            border: 8px solid; flex-direction: row; 
        }
        .layout-a4 .p-img { flex: 2; height: 100%; }
        .layout-a4 .p-txt { flex: 1; height: 100%; font-size: 90pt; border-left: 8px solid; background: #fdfdfd; }
    }
</style>
</head>
<body>

<header>
    <div style="font-weight:bold; font-size:1.2rem; color:#333;">ü¶Å TinyVocab</div>
    <div style="display:flex; gap:8px">
        <button class="btn" onclick="printA4()">A4</button>
        <button class="btn" onclick="printPoker()">Cards</button>
        <button class="btn btn-primary" onclick="startChild()">‚ñ∂ Child Mode</button>
    </div>
</header>

<div class="container">
    <div id="loading">Loading your deck...<br><small>If using GitHub, wait 60s after committing.</small></div>
    <div class="card-grid" id="grid"></div>
</div>

<div id="child-mode" class="hidden" style="display:none;">
    <button onclick="exitChild()" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:2rem; opacity:0.5; cursor:pointer;">‚úï</button>
    
    <div class="focus-card" id="focus-display">
        <img id="c-img" src="">
        <div class="word-box"><h1 id="c-word">Word</h1></div>
    </div>

    <div class="controls">
        <button class="nav-btn" onclick="move(-1)">üëà</button>
        <button class="nav-btn play-btn" onclick="speakDrill()">üîä</button>
        <button class="nav-btn" onclick="move(1)">üëâ</button>
    </div>
</div>

<div id="print-area"></div>

<script>
    let deck = [];
    let currentIndex = 0;
    const colors = { 
        animal: '#8AC926', food: '#FFCA3A', body: '#1982C4', 
        home: '#FF595E', act: '#6A4C93' 
    };

    // --- 1. DATA LOADING ---
    fetch('data.json')
        .then(res => res.json())
        .then(data => {
            deck = data;
            document.getElementById('loading').style.display = 'none';
            renderGrid();
        })
        .catch(e => {
            console.log(e);
            // Fallback for testing without data.json
            document.getElementById('loading').innerHTML = "‚ö†Ô∏è Can't find data.json.<br>Upload it to GitHub to see cards.";
        });

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = deck.map(card => {
            const col = colors[card.cat] || '#ccc';
            return `
            <div class="vocab-card" onclick="startChildAt('${card.word}')">
                <div class="card-img-frame">
                    <img src="${card.img}" loading="lazy" alt="${card.word}">
                </div>
                <div class="card-text-frame">
                    <div class="cat-indicator" style="background:${col}"></div>
                    <div class="word" style="color:${col}">${card.word}</div>
                </div>
            </div>
            `;
        }).join('');
    }

    // --- 2. CHILD MODE ---
    function startChildAt(word) {
        // Find index of clicked word
        currentIndex = deck.findIndex(c => c.word === word);
        if(currentIndex === -1) currentIndex = 0;
        startChild();
    }

    function startChild() {
        if(deck.length === 0) return;
        document.getElementById('child-mode').style.display = 'flex';
        updateDisplay();
        speakDrill(); // Auto-play on entry? Optional.
    }

    function exitChild() {
        document.getElementById('child-mode').style.display = 'none';
        window.speechSynthesis.cancel();
    }

    function updateDisplay() {
        const card = deck[currentIndex];
        const col = colors[card.cat] || '#333';
        
        document.getElementById('c-img').src = card.img;
        document.getElementById('c-word').innerText = card.word;
        document.getElementById('c-word').style.color = col;
        document.getElementById('focus-display').style.borderColor = col;
    }

    function move(dir) {
        window.speechSynthesis.cancel(); // Stop any current drill
        currentIndex = (currentIndex + dir + deck.length) % deck.length;
        updateDisplay();
        // Optional: Auto-play drill on slide change?
        // speakDrill(); 
    }

    // --- 3. SPEECH ENGINE (UK ACCENT + 3x DRILL) ---
    
    function getUKVoice() {
        const voices = window.speechSynthesis.getVoices();
        // Try to find exact UK match
        let voice = voices.find(v => v.lang === 'en-GB' || v.lang === 'en_GB');
        // Fallback to any English
        if (!voice) voice = voices.find(v => v.lang.includes('en'));
        return voice;
    }

    function speakDrill() {
        if (!window.speechSynthesis) return;
        
        const text = deck[currentIndex].word;
        const voice = getUKVoice();
        window.speechSynthesis.cancel(); // Stop overlap

        // 1. Normal
        const u1 = new SpeechSynthesisUtterance(text);
        if(voice) u1.voice = voice;
        u1.rate = 1.0; 

        // 2. Slow (Articulate)
        const u2 = new SpeechSynthesisUtterance(text);
        if(voice) u2.voice = voice;
        u2.rate = 0.6; // Slower
        u2.pitch = 1.1; // Slightly higher pitch keeps kid attention

        // 3. Normal (Reinforce)
        const u3 = new SpeechSynthesisUtterance(text);
        if(voice) u3.voice = voice;
        u3.rate = 1.0;

        // Chain them with pauses
        // Note: 'pause' property in Utterance is buggy in some browsers. 
        // We use a simple setTimeout chain or the onend event.
        
        u1.onend = () => { setTimeout(() => window.speechSynthesis.speak(u2), 800); };
        u2.onend = () => { setTimeout(() => window.speechSynthesis.speak(u3), 800); };
        
        window.speechSynthesis.speak(u1);
    }
    
    // Ensure voices are loaded (Chrome bug fix)
    window.speechSynthesis.onvoiceschanged = getUKVoice;

    // Keyboard Control
    document.addEventListener('keydown', (e) => {
        if (document.getElementById('child-mode').style.display === 'flex') {
            if(e.key === 'ArrowRight') move(1);
            if(e.key === 'ArrowLeft') move(-1);
            if(e.key === ' ' || e.key === 'Enter') speakDrill();
            if(e.key === 'Escape') exitChild();
        }
    });

    // --- 4. PRINT ENGINE ---
    function printPoker() {
        const area = document.getElementById('print-area');
        area.className = 'grid-poker';
        area.innerHTML = deck.map(c => {
            const col = colors[c.cat] || '#333';
            return `
            <div class="p-card" style="border-color:${col}">
                <div class="p-img"><img src="${c.img}"></div>
                <div class="stripe" style="background:${col}"></div>
                <div class="p-txt" style="color:${col}">${c.word}</div>
            </div>`;
        }).join('');
        window.print();
    }

    function printA4() {
        const area = document.getElementById('print-area');
        area.className = 'layout-a4';
        area.innerHTML = deck.map(c => {
            const col = colors[c.cat] || '#333';
            return `
            <div class="page">
                <div class="p-card" style="border-color:${col}">
                    <div class="p-img"><img src="${c.img}"></div>
                    <div class="p-txt" style="border-color:${col}; color:${col}">${c.word}</div>
                </div>
            </div>`;
        }).join('');
        window.print();
    }
</script>
</body>
</html>